{% extends "layout.html" %}
{% block title %}Servers{% endblock %}
{% block content %}
<div class="span9">
	{{ super() }}
	<div class="row">
		{% for srv in servers %}
		<div class="panel panel-info">
			<div class="panel-heading">
				{{srv}}
				{% if session.logged_in %}
				<span class="pull-right">
					<a class="btn btn-xs btn-primary" data-toggle="modal" data-gm="{{srv}}" data-target="#modal_new_server"><i class="fa fa-plus-circle"></i> Create Instance</a>
				</span>
				{% endif %}
			</div>
			<div class="panel-body">
				{% set server_instances = get_server_instances(srv) %}
				{% if server_instances != [] %}
				{% set server_bins = get_server_binaries(servers_basepath, srv) %}
				<table class="table table-condensed table-hover table-striped">
					<thead>
						<th>Status</th>
						<th>Port</th>
						<th>Server Name</th>
						<th>&nbsp;</th>
					</thead>
					<tbody>
						{% for srv_inst in server_instances %}
						<tr>
							<td>Running</td>
							<td>8303</td>
							<td>{{srv_inst.fileconfig}}</td>
							<td class="text-right">
								{% if session.logged_in %}
								<a class="btn btn-xs btn-default" data-id="{{srv_inst.id}}" data-toggle="modal" data-target="#modal_instance_configuration"><i class="fa fa-gear"></i> Config</a>
								<div class="dropdown btn-group">
								    <a id="btn-play-srv-{{srv_inst.id}}" class="btn btn-xs btn-success {% if srv_inst.bin == None %}disabled{% endif %}">
								        <i class="fa fa-play"></i> Start
								    </a>
								    <a class="btn btn-xs btn-success dropdown-toggle" data-toggle="dropdown" href="#">
								        <span class="caret"></span>
								    </a>
								    <ul class="dropdown-menu" data-id="{{srv_inst.id}}">
								    	{% for bin in server_bins %}
								    	<li class="{% if srv_inst.bin == bin %}active{% endif %}"><a href="#" class="menu-item-server-bin">{{bin}}</a></li>
								    	{% endfor %}
								    	{% if server_bins == [] %}
								    	<li class="text-center text-muted bg-warning"><i class="fa fa-warning"></i> No binaries found!</li>
								    	{% endif %}
								    </ul>
								</div>
								<a class="remove-server-instance" data-gm="{{srv}}" data-id="{{srv_inst.id}}" href="#" title="Remove server instance"><i class="fa fa-remove"></i></a>
								{% endif %}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% else %}
				<p class="text-center text-muted">No instances defined!</p>
				{% endif %}
			</div>
		</div>
		{% endfor %}
		{% if servers == [] %}
		<div class="panel panel-warning">
			<div class="panel-body text-center text-muted">
				No servers found!
			</div>
		</div>
		{% endif %}
	</div>
	
	{% include "includes/modal_new_server.html" %}
	{% include "includes/modal_instance_configuration.html" %}
</div>
{% endblock %}
{% block script %}
	<script type="text/javascript">
		var $SERVERS_BASEPATH = {{ servers_basepath|tojson|safe }};
	</script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/servers.js') }}"></script>
{% endblock %}