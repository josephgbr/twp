V"use strict";$(function(){$('#slide-nav.navbar-inverse').after($('<div class="inverse" id="navbar-height-col"></div>'));$('#slide-nav.navbar-default').after($('<div id="navbar-height-col"></div>'));var toggler='.navbar-toggle';var pagewrapper='#page-content';var navigationwrapper='.navbar-header';var menuwidth='100%';var slidewidth='30%';var menuneg='-100%';var slideneg='-30%';$("#slide-nav").on("click",toggler,function(e){var selected=$(this).hasClass('slide-active');$('#slidemenu').stop().animate({left:selected?menuneg:'0px'});$('#navbar-height-col').stop().animate({left:selected?slideneg:'0px'});$(pagewrapper).stop().animate({left:selected?'0px':slidewidth});$(navigationwrapper).stop().animate({left:selected?'0px':slidewidth});$(this).toggleClass('slide-active',!selected);$('#slidemenu').toggleClass('slide-active');});$(document).on("keypress",".deny-enter :input:not(textarea)",function(event){if(event.keyCode==13){event.preventDefault();}});refresh_main();window.setInterval('refresh_main()',$REFRESH_TIME);$('.colorpicker-input').colorpicker();$('.carrousel-fade').each(function(){$(this).carrouselanim();});var clipboard=new Clipboard('.btn-clipboard');clipboard.on('error',function(e){var $trigger=$(e.trigger);alert("Oops! your browser can't copy to clipboard...\u005cnYou need to copy manually:\u005cn\u005cn"+$trigger.data('clipboard-text'));});});var csrftoken=$('meta[name=csrf-token]').attr('content');$.ajaxSetup({beforeSend:function(xhr,settings){if(!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)&&!this.crossDomain){xhr.setRequestHeader("X-CSRFToken",csrftoken);}}});function refresh_main()\u000a{get_server_instances_online();get_host_localtime();}\u000afunction get_server_instances_online()\u000a{$.post($SCRIPT_ROOT+'/_get_server_instances_online','',function(data){check_server_data(data);if(data['success'])\u000a{var num=data['num'];if(num==0)\u000a$("#badge-num-server-instances").text("0").addClass('hidden');else\u000a$("#badge-num-server-instances").text(num).removeClass('hidden');}});}\u000afunction check_server_data(data)\u000a{if(!data||data==undefined)\u000areturn;if(data['notauth'])\u000a{bootbox.dialog({message:"<p class='text-center' style='color:#800000;'><i class='fa fa-warning'></i> "+$BABEL_STR_SESSION_EXPIRED+" <i class='fa fa-warning'></i></p>",title:$BABEL_STR_TITLE_SESSION_EXPIRED,buttons:{success:{label:"Oh!",className:"btn-default",callback:function(){window.location.reload();}}}});}\u000aelse if(data['error'])\u000a{var errormsg=data['errormsg']?data['errormsg']:$BABEL_STR_INTERNAL_ERROR;bootbox.dialog({message:"<p class='text-center' style='color:#800000;'>"+errormsg+"</p>",title:$BABEL_STR_ERROR_OOOPS+" <i class='fa fa-frown-o'></i>",buttons:{success:{label:$BABEL_STR_DAMN,className:"btn-default"}}});}}\u000afunction get_host_localtime()\u000a{$.post($SCRIPT_ROOT+'/_refresh_host_localtime','',function(data){$("#localtime").text(data['localtime']);});}\u000afunction get_config_value_textarea($ta,param)\u000a{var lines=$ta.splitlines();for(var i in lines)\u000a{var objMatch=lines[i].match(/^([^#\u005cs]+)\u005cs([^#\u005cr\u005cn]+)/);if(objMatch&&param.toLowerCase()===objMatch[1].toLowerCase())\u000areturn objMatch[2];}\u000areturn undefined;}\u000afunction update_config_textarea($ta,param,new_value,defval)\u000a{var lines=$ta.splitlines();var nvalue="";var replaced=false;for(var i in lines)\u000a{var objMatch=lines[i].match(/^([^#\u005cs]+)\u005cs([^#\u005cr\u005cn]+)/);if(objMatch&&param.toLowerCase()===objMatch[1].toLowerCase())\u000a{if((typeof defval==='undefined'&&new_value)||(typeof defval!=='undefined'&&new_value!=defval))\u000a{nvalue+=param+" "+new_value+"\u005cn";}\u000areplaced=true;}\u000aelse\u000anvalue+=lines[i]+"\u005cn";}\u000aif(!replaced&&((typeof defval==='undefined'&&new_value)||(typeof defval!=='undefined'&&new_value!=defval)))\u000a{nvalue+=param+" "+new_value+"\u005cn";}\u000a$ta.val(nvalue);}\u000a$.fn.extend({carrouselanim:function(option){var $this=$(this);function selItem(index,noAnim)\u000a{var $items=$this.data('carrousel-items');var selected=+$this.data('carrousel-sel');if(noAnim)\u000a{$items[selected].css('display','none');$items[index].css({display:'initial',opacity:1});}\u000aelse\u000a{$items[selected].animate({opacity:'0'},function(){$items[selected].css('display','none');});$items[index].css({display:'initial',opacity:0});$items[index].animate({opacity:1});}\u000a$this.data('carrousel-sel',index);};if(typeof(option)==="string")\u000a{switch(option)\u000a{case"next":var $items=$this.data('carrousel-items');var selected=+$this.data('carrousel-sel');if(selected<$items.length-1)\u000aselItem(selected+1);break;case"prev":var selected=+$this.data('carrousel-sel');if(selected>0)\u000aselItem(selected-1);break;}}\u000aelse if(typeof(option)==="integer")\u000a{selItem(option);}\u000aelse\u000a{var $items=[];var count=0;var activedSel=-1;$this.children('.carrousel-fade-list').children('.item').each(function(){var $_this=$(this);$_this.css({display:'none',position:'absolute',width:'100%',left:0});$items.push($_this);if($_this.hasClass('active'))\u000aactivedSel=count;++count;});$this.css({position:'relative'});$this.data('carrousel-items',$items);$this.data('carrousel-sel',0);$items[0].css('display','initial');$this.find('.next').each(function(){$(this).click(function(){$this.carrouselanim('next');return false;})});$this.find('.prev').each(function(){$(this).click(function(){$this.carrouselanim('prev');return false;})});if(activedSel!=-1)\u000aselItem(activedSel,true);}}});$.fn.extend({splitlines:function(){var lines=this.val().split(/\u005cn/);var texts=[];for(var i=0;i<lines.length;i++)\u000a{if(/\u005cS/.test(lines[i]))\u000atexts.push($.trim(lines[i]));}\u000areturn texts;}});function createAnimatedChartDonut(selector,data,chartType)\u000a{var chartData={'labels':data['labels'][chartType],'series':data['series'][chartType]};var chartConfig={donut:true,donutWidth:30,labelOffset:0,labelDirection:'explode'\u000a};var chart=new Chartist.Pie(selector,chartData,chartConfig);chart.on('draw',function(data){if(data.type==='slice'){var pathLength=data.element._node.getTotalLength();var animationDefinition={'stroke-dashoffset':{id:'anim'+data.index,dur:1000,from:-pathLength+'px',to:'0px',easing:Chartist.Svg.Easing.easeOutQuint,fill:'freeze'}};data.element.attr({'stroke-dashoffset':-pathLength+'px','stroke-dasharray':pathLength+'px '+pathLength+'px'});if(data.index!==0)\u000aanimationDefinition['stroke-dashoffset'].begin='anim'+(data.index-1)+'.end';data.element.animate(animationDefinition,false);}});}\u000afunction createAnimatedChartLine(selector,data,chartType)\u000a{var chartData={'labels':data['labels'][chartType],'series':[data['series'][chartType]]};var chartConfig={axisY:{type:Chartist.AutoScaleAxis,onlyInteger:true}};var chart=Chartist.Line(selector,chartData,chartConfig);var seq=0;chart.on('created',function(){seq=0;});chart.on('draw',function(data){if(data.type==='point'){data.element.animate({opacity:{begin:seq++*80,dur:500,from:0,to:1},x1:{begin:seq++*80,dur:500,from:data.x-100,to:data.x,easing:Chartist.Svg.Easing.easeOutQuart}});}});return chart;}\u000a"use strict";var $LOG_FILTER_TYPE=0;var $LOG_FILTER_ORDER=0;$(function(){$(document).on("keypress",".deny-enter :input:not(textarea)",function(ev){if(ev.keyCode==13){ev.preventDefault();}});if($('#server-log').length)\u000a{get_server_instance_log();}\u000a$("#filter-type").val($LOG_FILTER_TYPE).change(function(){$LOG_FILTER_TYPE=$(this).val();$('#server-log').html("");get_server_instance_log();});$("#filter-order").val($LOG_FILTER_ORDER).change(function(){$LOG_FILTER_ORDER=$(this).val();$('#server-log').html("");get_server_instance_log();});});function get_server_instance_log()\u000a{$.post($SCRIPT_ROOT+'/_get_server_instance_log/'+$SRVID+'/'+$SRVLOGCODE+'/'+$SRVLOGNAME,'',function(data){check_server_data(data);if(data['success']&&data['content'])\u000a{var curtext=$('#server-log').val();for(var i in data['content']){var table_row="<tr class='"+data['content'][i]['type']+"'><td>"+data['content'][i]['date']+"</td><td>"+data['content'][i]['section']+"</td><td>"+data['content'][i]['message']+"</td></tr>";if($LOG_FILTER_TYPE==0||($LOG_FILTER_TYPE==1&&data['content'][i]['type']=='danger')||($LOG_FILTER_TYPE==2&&data['content'][i]['type']=='warning')||($LOG_FILTER_TYPE==3&&data['content'][i]['type']=='success'))\u000a{if($LOG_FILTER_ORDER==0)\u000a$('#server-log').prepend(table_row);else\u000a$('#server-log').append(table_row);}}\u000a$('#server-log').prop('scrollTop',$('#server-log').prop('scrollHeight'));}});}\u000a"use strict";function refreshMemoryHost(){$.post($SCRIPT_ROOT+'/_refresh_memory_host','',function(data){check_server_data(data);$('#memory-usage').text(data.used+' / '+data.total+' MB').fadeIn();$('#memory-usage-bar').css({'width':data.percent+'%'});$('#memory-cache-usage-bar').css({'width':data.percent_cached+'%'});});}\u000afunction refreshCPUHost(){$.post($SCRIPT_ROOT+'/_refresh_cpu_host','',function(data){check_server_data(data);$('#cpu-usage').text(data+'%').fadeIn();$('#cpu-usage-bar').css({'width':data+'%'});});}\u000afunction refreshDiskHost(){$.post($SCRIPT_ROOT+'/_refresh_disk_host','',function(data){check_server_data(data);$('#disk-usage').text(data.used+' ('+data.free+' '+$BABEL_STR_FREE+')').fadeIn();$('#disk-usage-bar').css({'width':data.percent});});}\u000afunction refreshUptimeHost(){$.post($SCRIPT_ROOT+'/_refresh_uptime_host','',function(data){check_server_data(data);$('#uptime').text($BABEL_STR_UPTIME+' '+data.day+' '+$BABEL_STR_DAYS+' '+data.time).fadeIn();});}\u000afunction memory_color(value){if(value!=0)\u000aif('0'<=value&&value<='512')\u000areturn'success';else if('512'<=value&&value<'1024')\u000areturn'warning';else\u000areturn'important';}\u000afunction mastersrv_servers(){$.post($SCRIPT_ROOT+'/_get_all_online_servers','',function(data){check_server_data(data);$('#twmslist-load').hide();if(data['servers'].length>0)\u000a{var $table=$('#twmslist tbody');var cont=0;for(var i in data['servers'])\u000a{var row="<tr>";row+="<td>"+i+"</td>";row+="<td>"+data['servers'][i].name+"</td>";row+="<td>"+data['servers'][i].gametype+"</td>";row+="<td>"+data['servers'][i].players+"/"+data['servers'][i].max_players+"</td>";row+="<td>"+data['servers'][i].map+"</td>";row+="<td class='text-right'>"+Math.round(data['servers'][i].latency*1000)+"</td>";row+="</tr>";$table.append(row);}\u000a$('#twmslist').show();}\u000aelse\u000a{$('#twmslist-empty').show();}});}\u000afunction refresh(){refreshMemoryHost();refreshCPUHost();refreshDiskHost();refreshUptimeHost();}\u000a$(function(){$('#memory-usage').hide();$('#cpu-usage').hide();$('#disk-usage').hide();$('#uptime').hide();$('#twmslist').hide();$('#twmslist-empty').hide();refresh();mastersrv_servers();window.setInterval('refresh()',$REFRESH_TIME);$.post($SCRIPT_ROOT+'/_get_chart_values/machine','',function(data){if(!data['labels']||!data['series'])\u000areturn;createAnimatedChartLine('#chart-machine-players7d',data,'players7d');});});"use strict";var $LOG_SEEK=0;var $LOG_FILTER_TYPE=0;var $LOG_FILTER_ORDER=0;var $ISSUES_PAGINATION=[0,0]\u000avar $LOG_PAGINATION=[moment(new Date()).format("DD-MM-YYYY"),0]\u000avar $COUNTRIES=[];$.getJSON($SCRIPT_ROOT+'/static/json/countries.json',function(data){$COUNTRIES=data;});$(function(){$(document).on("keypress",".deny-enter :input:not(textarea)",function(ev){if(ev.keyCode==13){ev.preventDefault();}});if($('#server-log').length)\u000a{get_server_instance_log();}\u000a$(document).on('click','#log .pagination li>a',function(ev){var $this=$(this);var page=$this.data('page');if('prev'==page)\u000a{if($LOG_PAGINATION[0]>0)\u000a--$LOG_PAGINATION[0];}else if('next'==page)\u000a{if($LOG_PAGINATION[0]<$LOG_PAGINATION[1])\u000a++$LOG_PAGINATION[0];}\u000aelse\u000a$LOG_PAGINATION[0]=page;get_server_instance_log();ev.preventDefault();});$(document).on("click",".kick-player",function(){var $this=$(this);var nickname=$(this).data('name');$this.addClass('disabled').html("<i class='fa fa-spinner fa-spin'></i>");$.post($SCRIPT_ROOT+'/_kick_player/'+$SRVID,'nick='+encodeURIComponent(nickname),function(data){check_server_data(data);if(data['success'])\u000a{$this.parent().parent().remove();}});});$(document).on("click",".ban-player",function(){var $this=$(this);var nickname=$(this).data('name');$this.addClass('disabled').html("<i class='fa fa-spinner fa-spin'></i>");$.post($SCRIPT_ROOT+'/_ban_player/'+$SRVID,'nick='+encodeURIComponent(nickname),function(data){check_server_data(data);if(data['success'])\u000a{$('#pl-line-'+nickname).remove();}});});$.post($SCRIPT_ROOT+'/_get_chart_values/server/'+$SRVID,'',function(data){if(!data['labels']||!data['series'])\u000areturn;createAnimatedChartLine('#chart-players-7d',data,'players7d');createAnimatedChartDonut('#chart-active-clan',data,'topclan');for(var i in data['labels']['topcountry'])\u000a{var countryName=undefined;if(data['labels']['topcountry'][i]!=-1)\u000acountryName=$.grep($COUNTRIES,function(e){return e.codenum==data['labels']['topcountry'][i];});if(!countryName||!countryName[0])\u000acountryName=$BABEL_STR_UNKNOWN;else\u000acountryName=countryName[0].name;data['labels']['topcountry'][i]=countryName;}\u000acreateAnimatedChartDonut('#chart-active-country',data,'topcountry');});$("#filter-type").val($LOG_FILTER_TYPE).change(function(){$LOG_FILTER_TYPE=$(this).val();$LOG_SEEK=0;$('#server-log').html("");get_server_instance_log();});$("#filter-order").val($LOG_FILTER_ORDER).change(function(){$LOG_FILTER_ORDER=$(this).val();$LOG_SEEK=0;$('#server-log').html("");get_server_instance_log();});$('#share-url').val($('#server-banner').prop('src'));$(document).on("click","#generate-banner",function(event){var colorTitle=$('#color-title').data('colorpicker').color.toHex().substr(1);var colorDetail=$('#color-detail').data('colorpicker').color.toHex().substr(1);var colorAddress=$('#color-address').data('colorpicker').color.toHex().substr(1);var colorGradStart=$('#color-grad-start').data('colorpicker').color.toHex().substr(1);var colorGradEnd=$('#color-grad-end').data('colorpicker').color.toHex().substr(1);var params="title="+colorTitle+"&detail="+colorDetail+"&address="+colorAddress+"&grads="+colorGradStart+"&grade="+colorGradEnd;var $banner=$('#server-banner');$banner.prop('src','/server/1/banner?'+params);$('#share-url').val($banner.prop('src'));});$(document).on('shown.bs.modal','#modal_instance_issues',function(ev){refresh_issues();});$(document).on('click','#modal_instance_issues .pagination li>a',function(ev){var $this=$(this);var page=$this.data('page');if('prev'==page)\u000a{if($ISSUES_PAGINATION[0]>0)\u000a--$ISSUES_PAGINATION[0];}else if('next'==page)\u000a{if($ISSUES_PAGINATION[0]<$ISSUES_PAGINATION[1])\u000a++$ISSUES_PAGINATION[0];}\u000aelse\u000a$ISSUES_PAGINATION[0]=page;refresh_issues();ev.preventDefault();});window.setInterval('refresh_issues_count()',$REFRESH_TIME);refresh_issues_count();});function refresh_issues()\u000a{$.post($SCRIPT_ROOT+'/_get_server_issues/'+$SRVID+'/'+$ISSUES_PAGINATION[0],'',function(data){check_server_data(data);if(data['success'])\u000a{$ISSUES_PAGINATION[1]=+data['pages'];$('#modal_instance_issues #issues-list').html('');for(var i in data['issues'])\u000a{var row=data['issues'][i];var html="<tr>";html+="<td class='col-md-4'>"+moment(new Date(row[0])).format("DD-MM-YYYY HH:mm")+"</td>";html+="<td class='col-md-8'>"+row[1]+"</td>";html+="</tr>";$('#modal_instance_issues #issues-list').append(html);}\u000avar html="<li class='"+(0==$ISSUES_PAGINATION[0]?'disabled':'')+"'><a href='#' data-page='prev' aria-label='Previous'><span aria-hidden='true'>&laquo;</span></a></li>";var start_page=Math.max(0,$ISSUES_PAGINATION[0]-3);var end_page=Math.min($ISSUES_PAGINATION[0]+3,$ISSUES_PAGINATION[1]);if(end_page<7&&$ISSUES_PAGINATION[1]>=7)\u000aend_page=6;for(var i=start_page;i<=end_page;i++)\u000ahtml+="<li class='"+(i==$ISSUES_PAGINATION[0]?'active':'')+"'><a data-page='"+i+"' href='#'>"+i+"</a></li>";html+="<li class='"+($ISSUES_PAGINATION[1]==$ISSUES_PAGINATION[0]?'disabled':'')+"'><a href='#' data-page='next' aria-label='Next'><span aria-hidden='true'>&raquo;</span></a></li>";$('#modal_instance_issues .pagination').html(html);}});}\u000afunction refresh_issues_count()\u000a{$.post($SCRIPT_ROOT+'/_get_server_issues_count/'+$SRVID,'',function(data){$('#issues_count').text(data['success']?data['issues_count']:'0');});}\u000afunction get_server_instance_log()\u000a{$.post($SCRIPT_ROOT+'/_get_server_instance_log/'+$SRVID+'/'+$LOG_PAGINATION[0],'',function(data){check_server_data(data);if(data['success']&&data['content'])\u000a{$('#server-log').html("");for(var i in data['content']){var table_row="<tr class='"+data['content'][i]['type']+"'><td>"+data['content'][i]['date']+"</td><td>"+data['content'][i]['section']+"</td><td>"+data['content'][i]['message']+"</td></tr>";if($LOG_FILTER_TYPE==0||($LOG_FILTER_TYPE==1&&data['content'][i]['type']=='danger')||($LOG_FILTER_TYPE==2&&data['content'][i]['type']=='warning')||($LOG_FILTER_TYPE==3&&data['content'][i]['type']=='success'))\u000a{if($LOG_FILTER_ORDER==0)\u000a$('#server-log').prepend(table_row);else\u000a$('#server-log').append(table_row);}}\u000aif(data['pages'])\u000a{var datepages=Object.keys(data['pages']).reverse();var curIndex=datepages.indexOf($LOG_PAGINATION[0]);$LOG_PAGINATION[1]=datepages.length-1;$('#server-log').prop('scrollTop',$('#server-log').prop('scrollHeight'));var html="<li class='"+(0==curIndex?'disabled':'')+"'><a href='#' data-page='prev' aria-label='Previous'><span aria-hidden='true'>&laquo;</span></a></li>";var start_page=Math.max(0,curIndex-3);var end_page=Math.min(curIndex+3,$LOG_PAGINATION[1]);if(end_page<7&&$LOG_PAGINATION[1]>=7)\u000aend_page=6;for(var i=start_page;i<=end_page;i++)\u000ahtml+="<li class='"+(i==curIndex?'active':'')+"'><a data-page='"+datepages[i]+"' href='#'>"+datepages[i]+"</a></li>";html+="<li class='"+(curIndex==$LOG_PAGINATION[1]?'disabled':'')+"'><a href='#' data-page='next' aria-label='Next'><span aria-hidden='true'>&raquo;</span></a></li>";$('#log .pagination').html(html);}}});}\u000a"use strict";$(function(){$(document).on("change","#install-mod input[type='file']",function(){var $this=$(this);var $btn=$('#install-mod-button');var file=this.files[0];$btn.removeClass('btn-default').addClass('btn-success disabled');$btn.html("<i class='fa fa-refresh fa-spin'></i> "+$BABEL_STR_INSTALLING+" '"+file.name+"'...");bootbox.dialog({message:"<div class='text-center text-muted'><h1><i class='fa fa-circle-o-notch fa-spin'></i><br/>"+$BABEL_STR_PLEASE_WAIT+"</h1></div>",buttons:{}});$('#install-mod #url').val('');$('#install-mod').submit();});$(document).on("change","#upload-maps input[type='file']",function(){var $this=$(this);var $btn=$('#btn-upload-map');var srvid=$('#form-server-config #srvid').val();var file=this.files[0];var origHTML=$btn.html();$btn.removeClass('btn-default').addClass('btn-success disabled');$btn.html("<i class='fa fa-refresh fa-spin'></i> "+$BABEL_STR_UPLOADING+" '"+file.name+"'...");$.ajax({url:'/_upload_maps/'+srvid,type:'POST',data:new FormData($('#upload-maps')[0]),contentType:false,cache:false,processData:false,async:false,success:function(data){check_server_data(data);if(data['success'])\u000a{refresh_server_maps_list(srvid);if(".map"===file.name.substr(-4))\u000a{var $line=$("tr#row-"+file.name.substr(0,file.name.length-4));var $list=$("#maplist-container");$list.animate({scrollTop:$line.offset.top-$list.offset.top+$list.scrollTop()});}}\u000a$btn.removeClass('btn-default').removeClass('btn-success disabled').addClass('btn-default');$btn.html(origHTML);},error:function(){check_server_data({'error':true,'errormsg':$BABEL_STR_UNEXPECTED_ERROR});$btn.removeClass('btn-default').removeClass('btn-success disabled').addClass('btn-default');$btn.html(origHTML);}});});$(document).on("click","#install-mod-url",function(){bootbox.prompt($BABEL_STR_URL_TO_PACKAGE,function(result){if(result!==null){var $btn=$('#install-mod-button');$btn.removeClass('btn-default').addClass('btn-success disabled');$btn.html("<i class='fa fa-refresh fa-spin'></i> "+$BABEL_STR_INSTALLING);bootbox.dialog({message:"<div class='text-center text-muted'><h1><i class='fa fa-circle-o-notch fa-spin'></i><br/>"+$BABEL_STR_PLEASE_WAIT+"</h1></div>",buttons:{}});$('#install-mod #url').val(result);$('#install-mod').submit();}});});$(document).on("click","a[data-target='#modal_new_server']",function(){var mod=$(this).data('mod');$('#modal_new_server #mod').val(mod);var $cfglist=$('#modal_new_server #configs');$cfglist.children().remove();$('#modal_new_server #cfgfile').val("");$.post($SCRIPT_ROOT+'/_get_mod_configs/'+mod,'',function(data){if(data['configs']&&data['configs'].length>0)\u000a{$('#modal_new_server #cfgfile').val(data['configs'][0]);for(i in data['configs'])\u000a$cfglist.append("<option value='"+data['configs'][i]+"'>"+data['configs'][i]+"</option>");}});});$(document).on("click","#modal_new_server .btn-success",function(){var srvmod=$('#modal_new_server #mod').val();var configfile=$(".modal-body #cfgfile").val();if(!configfile)\u000areturn;$.post($SCRIPT_ROOT+'/_create_server_instance/'+srvmod,'fileconfig='+configfile,function(data){check_server_data(data);if(data['success'])\u000a{$('#modal_new_server').modal('hide');window.location.reload();}});});$(document).on("click",".remove-server-instance",function(){var srvid=$(this).data('id');var srvmod=$(this).data('mod');bootbox.dialog({message:$BABEL_STR_ARE_YOU_SURE+"<br/><input type='checkbox' name='delete-configfile'/>"+$BABEL_STR_DELETE_CONF,title:$BABEL_STR_DELETE+" '"+srvmod+"' "+$BABEL_STR_SERVER_INSTANCE,buttons:{success:{label:$BABEL_STR_DELETE,className:"btn-danger",callback:function(){var delconfig=$("input[name='delete-configfile']:checked").val()==='on'?'1':'0';$.post($SCRIPT_ROOT+'/_remove_server_instance/'+srvid+'/'+delconfig,'',function(data){check_server_data(data);if(data['success'])\u000a{window.location.reload();}});}},main:{label:"Cancel",className:"btn-default"}}});});$(document).on("click","a[data-target='#modal_external_console']",function(){var srvid=$(this).data('id');$("#modal_external_console #srvid").val(srvid);$("#modal_external_console #econ-log").val('');setTimeout("$('#modal_external_console #cmd').focus()",150);});$(document).on("click","#modal_external_console #send-econ-command",function(){var $this=$(this);var srvid=$this.data('id');if($this.hasClass('disabled'))\u000areturn;$this.addClass('disabled').html("<i class='fa fa-spinner fa-spin'></i> "+$BABEL_STR_SENDING);$.post($SCRIPT_ROOT+'/_send_econ_command/'+$('#form-econ #srvid').val(),$('#form-econ').serialize(),function(data){$this.removeClass('disabled').text("Send");check_server_data(data);if(data['success'])\u000a{$("#modal_external_console #cmd").val('');var $econlog=$("#modal_external_console #econ-log");var last_content=$econlog.val();$econlog.val(last_content+data['rcv']);$econlog.prop('scrollTop',$econlog.prop('scrollHeight'));$('#modal_external_console #cmd').focus();}});});$(document).on("click",".menu-item-server-bin",function(){var $this=$(this);var $parent_ul=$this.parent().parent();var srvid=$parent_ul.data('id');var srvbin=$this.text().trim();$.post($SCRIPT_ROOT+'/_set_server_binary/'+srvid+'/'+srvbin,'',function(data){check_server_data(data);if(data['success'])\u000a{$parent_ul.find('li').removeClass('active');$this.parent().addClass('active');$('#btn-play-srv-'+srvid+' .start-instance').removeClass('disabled');}});});$('#modal_instance_configuration').modal({'backdrop':'static','show':false});$(document).on("click","a[data-target='#modal_instance_configuration']",function(){var srvid=$(this).data('id');$('#form-server-config #srvid').val(srvid);$.post($SCRIPT_ROOT+'/_get_server_config/'+srvid,'',function(data){check_server_data(data);if(data['success'])\u000a{$("#modal_instance_configuration #check_alsrv").prop('checked',data['alsrv']);$("#modal_instance_configuration #srvcfg").val(data['srvcfg']);$("#modal_instance_configuration .modal-title").text("Instance Configuration: "+data['fileconfig']);}\u000aelse\u000a{$("#modal_instance_configuration #check_alsrv").prop('checked',false);$("#modal_instance_configuration #srvcfg").val("");$("#modal_instance_configuration .modal-title").text($BABEL_STR_INSTANCE_CONF);}});});$(document).on("change",".check_map",function(){update_advance_config_maps();});$(document).on("click",".remove-map",function(){var map=$(this).data("map");var srvid=$('#form-server-config #srvid').val();$.post($SCRIPT_ROOT+'/_remove_map/'+srvid,'map='+map,function(data){check_server_data(data);if(data['success'])\u000a{$("tr#row-"+map).remove();update_advance_config_maps();}});});$(document).on("change",".wizard-param",function(){var $this=$(this);var value=$this.val();var defval=$this.data('default')==='undefined'?undefined:$this.data('default');if($this.is("input")&&"checkbox"===$this.prop("type"))\u000avalue=$this.prop('checked')?1:0;update_config_textarea($("#modal_instance_configuration #srvcfg"),$this.attr("id"),value,defval);});$(document).on("change","#check_alsrv",function(){$("#modal_instance_configuration #alsrv").val($(this).is(":checked"));});$("ul.nav-tabs > li > a").on("shown.bs.tab",function(e){var id=$(e.target).attr("href").substr(1);var srvid=$('#form-server-config #srvid').val();if("maps"===id)\u000arefresh_server_maps_list(srvid);else if("wizard"===id)\u000agenerate_wizard($('#wizard'),srvid);});$(document).on("click","#modal_instance_configuration .btn-success",function(){var $this=$(this);$.post($SCRIPT_ROOT+'/_save_server_config/'+$("#form-server-config #srvid").val(),$('#form-server-config').serialize(),function(data){check_server_data(data);if(data['success'])\u000a{var srvline_id='#srv-line-'+data['id'];var $port=$(srvline_id+' .srv-port');var $name=$(srvline_id+' .srv-name');var $gametype=$(srvline_id+' .srv-gametype');var $flags=$(srvline_id+' .srv-flags');$port.text(data['port']);$name.text(data['name']);$gametype.text(data['gametype']);if(data['visible']==0)\u000a$flags.find('.tw-no-register').addClass('fa-eye').removeClass('fa-eye-slash').css('color','#333').prop('title',$BABEL_STR_PRIVATE_SERVER);else\u000a$flags.find('.tw-no-register').addClass('fa-eye-slash').removeClass('fa-eye').css('color','#BBB').prop('title',$BABEL_STR_PUBLIC_SERVER);if(data['public']==0)\u000a$flags.find('.tw-password').css('color','#333').prop('title',$BABEL_STR_REGISTER_SERVER);else\u000a$flags.find('.tw-password').css('color','#BBB').prop('title',$BABEL_STR_NOT_REGISTER_SERVER);$('#modal_instance_configuration').modal('hide');}});});$(document).on("click",".start-instance",function(){var $this=$(this);var srvid=$this.data('id');var $listline=$('#srv-line-'+srvid);var $btngroup=$('#btn-play-srv-'+srvid);var $btnlist=$btngroup.find('.dropdown-toggle');$this.addClass('disabled btn-warning').removeClass('btn-success');$btnlist.addClass('disabled btn-warning').removeClass('btn-success');$listline.find("a[data-target='#modal_instance_configuration']").addClass('disabled hidden');$listline.find(".remove-server-instance").addClass('disabled');$this.html("<i class='fa fa-spinner fa-spin'></i> "+$BABEL_STR_STARTING);$.post($SCRIPT_ROOT+'/_start_server_instance/'+srvid,'',function(data){if(data['error'])\u000a{$this.removeClass('disabled btn-warning').addClass('btn-success');$btnlist.removeClass('disabled btn-warning').addClass('btn-success');$listline.find("a[data-target='#modal_instance_configuration']").removeClass('disabled hidden');$listline.find(".remove-server-instance").removeClass('disabled');$this.html("<i class='fa fa-play'></i> "+$BABEL_STR_START);}\u000acheck_server_data(data);if(data['success'])\u000a{window.location.reload();}});});$(document).on("click",".stop-instance",function(){var srvid=$(this).data('id');$.post($SCRIPT_ROOT+'/_stop_server_instance/'+srvid,'',function(data){check_server_data(data);if(data['success'])\u000a{window.location.reload();}});});$(document).on("click",".remove-mod",function(){var mod_folder=$(this).data('mod');bootbox.dialog({message:$BABEL_STR_ARE_YOU_SURE+"<br/><span class='text-danger'>"+$BABEL_STR_THIS_CANT_BE_CANCELED+"</span>",title:$BABEL_STR_REMOVE+" '"+mod_folder+"' Mod",buttons:{success:{label:$BABEL_STR_REMOVE,className:"btn-danger",callback:function(){$.post($SCRIPT_ROOT+'/_remove_mod','folder='+mod_folder,function(data){check_server_data(data);if(data['success'])\u000a{window.location.reload();}});}},main:{label:$BABEL_STR_CANCEL,className:"btn-default"}}});});});function refresh_server_maps_list(srvid)\u000a{var maps=new Array();var maps_str=get_config_value_textarea($("#modal_instance_configuration #srvcfg"),"sv_maprotation");if(maps_str)\u000amaps=maps_str.split(" ");maps.push(get_config_value_textarea($("#modal_instance_configuration #srvcfg"),"sv_map"));$.post($SCRIPT_ROOT+'/_get_server_maps/'+srvid,'',function(data){check_server_data(data);if(data['success'])\u000a{$("#maplist").html("");for(var i in data['maps'])\u000a{var mapSelected=maps.indexOf(data['maps'][i].name)>=0;var row="<tr id='row-"+data['maps'][i].name+"'>";row+="<td><input type='checkbox' name='map_used' class='check_map' data-map='"+data['maps'][i].name+"' "+(mapSelected?'checked':'')+"/></td>";row+="<td>"+data['maps'][i].name+"</td>";row+="<td>"+data['maps'][i].size+"</td>";row+="<td class='text-right'><a class='remove-map btn btn-xs' data-map='"+data['maps'][i].name+"' href='#' title='"+$BABEL_STR_REMOVE_MAP+"'><i class='fa fa-remove'></i></a></td>";row+="</tr>";$("#maplist").append(row);}}});}\u000afunction generate_wizard($wizard,srvid)\u000a{$.getJSON($SCRIPT_ROOT+'/static/json/base_conf.json',function(data){$.post($SCRIPT_ROOT+'/_get_mod_wizard_config/'+srvid,'',function(mdata){check_server_data(mdata);var mcfg=data;if(mdata['success']&&mdata['config'])\u000a$.extend(true,mcfg,data,$.parseJSON(mdata['config']));var html="";html+="<ul id='simple-tabs' class='nav nav-pills nav-justified' role='tablist'>";$.each(mcfg,function(section,variables){html+="<li><a href='#"+section.replace(" ","_")+"' data-toggle='tab'>"+section+"</a></li>";});html+="</ul>";html+="<div class='tab-content' style='margin-top:1.5em;'>";$.each(mcfg,function(section,variables){html+="<div class='tab-pane' id='"+section.replace(" ","_")+"' style='overflow:auto; height:220px;'>";$.each(variables,function(key,val){var defval=val.default;var rval=get_config_value_textarea($("#modal_instance_configuration #srvcfg"),key);if(!rval)\u000arval=defval;if("select"===val.type)\u000a{html+="<label for='"+key+"'>"+val.label+"</label>";html+="<select id='"+key+"' data-default='"+defval+"' class='form-control wizard-param' title='"+(val.tooltip?val.tooltip:'')+"'>";for(var i in val.values)\u000ahtml+="<option value='"+val.values[i]+"' "+(val.values[i]==rval?'selected':'')+">"+val.values[i]+"</option>";html+="</select>";}\u000aelse if("checkbox"===val.type)\u000a{html+="<input class='wizard-param' data-default='"+defval+"' id='"+key+"' type="+val.type+" title='"+(val.tooltip?val.tooltip:'')+"' "+(1==rval?'checked':'')+"/> <span style='font-weight:bold'>"+val.label+"</span><br/>";}\u000aelse\u000a{html+="<label for='"+key+"'>"+val.label+"</label>";html+="<input id='"+key+"' data-default='"+defval+"' type="+val.type+" value='"+(rval?rval:'')+"' "+(val.range?"min='"+val.range[0]+"' max='"+val.range[1]+"'":'')+" class='form-control wizard-param' title='"+(val.tooltip?val.tooltip:'')+"' />";}});html+="</div>";});html+="</div>";$wizard.html(html);$('#simple-tabs a:first').tab('show');});});}\u000afunction update_advance_config_maps()\u000a{var maps=new Array();$("input[name=map_used]:checked").each(function(){maps.push($(this).data('map'));});update_config_textarea($("#modal_instance_configuration #srvcfg"),"sv_map",(maps.length>0)?maps[0]:undefined);update_config_textarea($("#modal_instance_configuration #srvcfg"),"sv_maprotation",(maps.length>1)?maps.join(" "):undefined);}\u000a"use strict";$(function(){$(document).on('click',"#form-settings-change-pass a[id='btn-submit']",function(e){var passOld=$('#pass-old').val();var passNew=$('#pass-new').val();var passNewRepeat=$('#pass-new-repeat').val();$('#pass-old,#pass-new,#pass-new-repeat').tooltip('hide');if(!passOld)\u000a{$('#pass-old').tooltip({trigger:'manual',placement:'bottom',title:$BABEL_STR_CANT_BE_EMPTY});$('#pass-old').tooltip('show');return;}\u000aif(!passNew)\u000a{$('#pass-new').tooltip({trigger:'manual',placement:'bottom',title:$BABEL_STR_CANT_BE_EMPTY});$('#pass-new').tooltip('show');return;}\u000aif(!passNewRepeat)\u000a{$('#pass-new-repeat').tooltip({trigger:'manual',placement:'bottom',title:$BABEL_STR_CANT_BE_EMPTY});$('#pass-new-repeat').tooltip('show');return;}\u000aif(passNew!==passNewRepeat)\u000a{$('#pass-new-repeat').tooltip({trigger:'manual',placement:'bottom',title:$BABEL_STR_PASSWORD_DOESNT_MATCH});$('#pass-new-repeat').tooltip('show');return;}\u000avar hashObj=new jsSHA("SHA-512","TEXT");hashObj.update(passNew);passNew=hashObj.getHash("HEX");$.post($SCRIPT_ROOT+'/_set_user_password','pass_old='+passOld+'&pass_new='+passNew,function(data){check_server_data(data);if(data['success'])\u000a{$('#admin-pass-old,#admin-pass-new,#admin-pass-new-repeat').val('');bootbox.dialog({message:"<p class='text-center' style='color:#008000;'><i class='fa fa-check'></i> "+$BABEL_STR_PASSWORD_CHANGED_SUCCESSFULLY+"</p>",title:$BABEL_STR_CONFIGURATION_CHANGED,buttons:{success:{label:$BABEL_STR_OK,className:"btn-default",callback:function(){window.location.reload();}}}});}});});$(document).on("click","#create_user_slot",function(){$.post($SCRIPT_ROOT+'/_create_user_slot','',function(data){check_server_data(data);if(data['success']&&data['user'])\u000a{var createDate=moment(data['user']['create_date']).utc().format("YYYY-MM-DD HH:mm:ss");var row="<tr id='user-"+data['user']['id']+"'>"+\u000a"<td><i>User Slot '"+data['user']['token'].slice(0,10)+"...'</i></td>"+\u000a"<td>"+createDate+"</td>"+\u000a"<td>"+$BABEL_STR_NEVER+"</td>"+\u000a"<td class='text-right'>"+\u000a"<a data-uid='"+data['user']['id']+"' class='btn btn-xs btn-success copy-link-user btn-clipboard' data-clipboard-text='http://"+window.location.host+"/user_reg/"+data['user']['token']+"'>"+\u000a"<i class='fa fa-link'></i> "+$BABEL_STR_COPY_LINK+\u000a"</a> "+\u000a"<a data-uid='"+data['user']['id']+"' class='btn btn-xs btn-default' data-toggle='modal' data-target='#modal_user_permissions'>"+\u000a"<i class='fa fa-cog'></i> Permissions"+\u000a"</a> "+\u000a"<a class='remove-user btn btn-xs btn-delete-row' data-uid='"+data['user']['id']+"' href='#' title='Cancel User Slot'><i class='fa fa-remove'></i></a>"+\u000a"</td>";$('#tbody-users').append(row);}});return false;});$(document).on("click","a[data-target='#modal_create_permission_level']",function(){$('#form-create-permission-level #name').val('');$("#form-create-permission-level input[type='checkbox']").each(function(){$(this).prop('checked',false);});});$(document).on("click","#modal_create_permission_level .btn-success",function(){$.post($SCRIPT_ROOT+'/_create_permission_level',$('#form-create-permission-level').serialize(),function(data){check_server_data(data);if(data['success']&&data['perm'])\u000a{var row="<tr id='permission-"+data['perm']['id']+"'>"+\u000a"<td>"+data['perm']['name']+"</td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='start' class='btn btn-xs btn-perm' style='color:"+(data['perm']['start']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['start']?'fa-check':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='stop' class='btn btn-xs btn-perm' style='color:"+(data['perm']['stop']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['stop']?'fa-check success':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='config' class='btn btn-xs btn-perm' style='color:"+(data['perm']['config']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['config']?'fa-check success':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='econ' class='btn btn-xs btn-perm' style='color:"+(data['perm']['econ']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['econ']?'fa-check success':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='issues' class='btn btn-xs btn-perm' style='color:"+(data['perm']['issues']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['issues']?'fa-check success':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-center'><a data-id='"+data['perm']['id']+"' data-perm='log' class='btn btn-xs btn-perm' style='color:"+(data['perm']['log']?'#008000':'#800000')+"'><i class='fa "+(data['perm']['log']?'fa-check success':'fa-minus')+"'></i></a></td>"+\u000a"<td class='text-right'>"+\u000a"<a class='remove-permission-level btn btn-xs btn-delete-row' data-id='"+data['perm']['id']+"' href='#' title='"+$BABEL_STR_REMOVE_PERMISSION_LEVEL+"'><i class='fa fa-remove'></i></a>"+\u000a"</td>"+\u000a"</tr>";$('#tbody-permission-levels').append(row);$('#modal_create_permission_level').modal('hide');$('#modal_user_permissions select').append("<option value='"+data['perm']['id']+"'>"+data['perm']['name']+"</option>");}});});$(document).on('click','.btn-perm',function(){var $this=$(this);var id=$this.data('id');var perm=$this.data('perm');toggle_perm_icon($this.children('i'));$.post($SCRIPT_ROOT+'/_change_permission_level','id='+id+'&perm='+perm,function(data){check_server_data(data);if(!data['success'])\u000atoggle_perm_icon($this.children('i'));});return false;});$(document).on("click",".remove-permission-level",function(){var permid=$(this).data('id');bootbox.dialog({message:$BABEL_STR_ARE_YOU_SURE,title:$BABEL_STR_DELETE+" "+$BABEL_STR_PERMISSION_LEVEL,buttons:{success:{label:$BABEL_STR_DELETE,className:"btn-danger",callback:function(){$.post($SCRIPT_ROOT+'/_remove_permission_level/'+permid,'',function(data){check_server_data(data);if(data['success'])\u000a{$('#permission-'+permid).remove();$('#modal_user_permissions select').children("option[value='"+permid+"']").remove();}});}},main:{label:"Cancel",className:"btn-default"}}});return false;});$(document).on("click",".remove-user",function(){var uid=$(this).data('uid');bootbox.dialog({message:$BABEL_STR_ARE_YOU_SURE,title:$BABEL_STR_DELETE+" "+$BABEL_STR_USER,buttons:{success:{label:$BABEL_STR_DELETE,className:"btn-danger",callback:function(){$.post($SCRIPT_ROOT+'/_remove_user/'+uid,'',function(data){check_server_data(data);if(data['success'])\u000a$('#user-'+uid).remove();});}},main:{label:"Cancel",className:"btn-default"}}});return false;});$(document).on("click","a[data-target='#modal_user_permissions']",function(){var uid=$(this).data('uid');$('#modal_user_permissions #uid').val(uid);$.post($SCRIPT_ROOT+'/_get_user_servers_level/'+uid,'',function(data){check_server_data(data);$("#modal_user_permissions select").each(function(){$(this).children("option")[0].selected=true;});if(data['success'])\u000a{for(var i in data['perms'])\u000a$('#modal_user_permissions #perm-'+data['perms'][i][0]+' option[value='+data['perms'][i][1]+']')[0].selected=true;}\u000aelse\u000a$('#modal_user_permissions').modal('hide');});});$(document).on('change','#modal_user_permissions select',function(){var uid=$('#modal_user_permissions #uid').val();var $this=$(this);var select_id=$this.attr('id');var select_val=$this.val();var srvid=$this.data('srvid');$.post($SCRIPT_ROOT+'/_set_user_server_level/'+uid+'/'+srvid,'perm_id='+select_val,function(data){check_server_data(data);});});});function toggle_perm_icon(elm)\u000a{if(elm.hasClass('fa-check'))\u000aelm.removeClass('fa-check').addClass('fa-minus').css('color','#800000');else\u000aelm.removeClass('fa-minus').addClass('fa-check').css('color','#008000');}
p1
.